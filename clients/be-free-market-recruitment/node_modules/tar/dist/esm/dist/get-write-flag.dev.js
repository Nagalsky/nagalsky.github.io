"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getWriteFlag = void 0;

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

// Get the appropriate flag to use for creating files
// We use fmap on Windows platforms for files less than
// 512kb.  This is a fairly low limit, but avoids making
// things slower in some cases.  Since most of what this
// library is used for is extracting tarballs of many
// relatively small files in npm packages and the like,
// it can be a big boost on Windows platforms.
var platform = process.env.__FAKE_PLATFORM__ || process.platform;
var isWindows = platform === 'win32';
/* c8 ignore start */

var _fs$constants = _fs["default"].constants,
    O_CREAT = _fs$constants.O_CREAT,
    O_TRUNC = _fs$constants.O_TRUNC,
    O_WRONLY = _fs$constants.O_WRONLY;
var UV_FS_O_FILEMAP = Number(process.env.__FAKE_FS_O_FILENAME__) || _fs["default"].constants.UV_FS_O_FILEMAP || 0;
/* c8 ignore stop */

var fMapEnabled = isWindows && !!UV_FS_O_FILEMAP;
var fMapLimit = 512 * 1024;
var fMapFlag = UV_FS_O_FILEMAP | O_TRUNC | O_CREAT | O_WRONLY;
var getWriteFlag = !fMapEnabled ? function () {
  return 'w';
} : function (size) {
  return size < fMapLimit ? fMapFlag : 'w';
};
exports.getWriteFlag = getWriteFlag;
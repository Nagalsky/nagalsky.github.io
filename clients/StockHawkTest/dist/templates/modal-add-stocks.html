<div
  class="fixed inset-0 z-[1000] h-full w-full overflow-y-auto bg-[#11142D]/50 duration-300"
  x-show="showModalAddStock"
  x-transition:enter="transition duration-300"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition duration-300"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
>
  <div
    class="relative mx-4 w-auto py-10 opacity-100 md:mx-auto md:flex md:min-h-screen md:items-center md:justify-center"
    x-data="loadInstrumentsModal()"
    x-init="$watch('search', () => fetchInstruments())"
    x-effect="getExistingInstruments(existingStocks)"
  >
    <div
      class="relative z-20 w-full rounded-[14px] border border-[#f2f2f2] bg-white bg-[url('../img/modal-mask.svg')] bg-[length:300px_250px] bg-[right_-138px_top_-2px] bg-no-repeat px-4 py-6 shadow-[0_67px_109px_0_rgba(0,0,0,0.05)] md:w-[612px] md:px-6 md:py-12"
      @click.away="()  => {
        showModalAddStock = false;
        search = '';
        selectedInstruments = [];
      }"
    >
      <h2 class="mb-4 text-[20px] font-semibold">Add Stocks</h2>
      <p class="mb-4 text-[12px] text-gray500">Supporting text comes here</p>

      <div class="relative">
        <div
          class="relative flex h-[56px] items-center space-x-4 rounded-[8px] border border-gray300 bg-white px-4"
        >
          <div class="shrink-0 text-gray400">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </div>

          <input
            type="text"
            class="grow border-0 px-0 placeholder:tracking-[0.09px] placeholder:text-gray400 focus:ring-0 focus:placeholder:text-transparent"
            placeholder="Enter tickers or companies to get started..."
            x-model="search"
            x-ref="searchField"
            x-on:keydown.window.prevent.slash="$refs.searchField.focus()"
            @click.away="search = ''"
          />
        </div>

        <template x-if="instruments.length">
          <div
            class="absolute left-0 top-[calc(100%_+_2px)] z-20 max-h-[280px] w-full overflow-auto rounded-[8px] border border-gray300 bg-white shadow-[9px_8px_34px_rgba(0,0,0,0.05)] md:max-h-[340px]"
          >
            <template
              x-for="instrument in instruments"
              :key="instrument.instrumentId"
            >
              <div
                @click="() => {
                  selectInstrument(instrument);
                  search = '';
                }"
                class="flex min-w-0 cursor-pointer flex-nowrap space-x-[20px] border-b border-b-gray300 px-4 py-4 text-[14px] font-bold text-black transition last-of-type:border-b-0 hover:bg-blue300 md:px-6 md:py-[17.5px] md:text-[16px]"
              >
                <span x-text="instrument.symbol" class="shrink-0"></span>
                <span x-text="instrument.name" class="truncate"></span>
              </div>
            </template>
            <template x-if="noInstruments">
              <p class="text-[16px] font-bold text-black">No results found</p>
            </template>
          </div>
        </template>

        <template x-if="noInstruments">
          <div
            class="absolute left-0 top-[calc(100%_+_2px)] z-20 max-h-[280px] w-full overflow-auto rounded-[8px] border border-gray300 bg-white shadow-[9px_8px_34px_rgba(0,0,0,0.05)] md:max-h-[340px]"
          >
            <div
              class="cursor-pointer px-4 transition hover:bg-blue300 md:px-6 md:py-[17.5px]"
              @click="search = ''"
            >
              <p class="text-[14px] font-bold text-black md:text-[16px]">
                No results found
              </p>
            </div>
          </div>
        </template>
      </div>

      <template x-if="selectedInstruments.length">
        <div class="mt-2">
          <template
            x-for="selectedInstrument in selectedInstruments"
            :key="selectedInstrument.instrumentId"
          >
            <div
              class="flex items-center justify-between space-x-5 border-b border-b-gray300 py-6"
            >
              <div class="flex min-w-0 items-center space-x-3">
                <div
                  class="h-[40px] w-[40px] shrink-0 overflow-hidden rounded-full bg-gray500"
                >
                  <img
                    :src="`https://storage.googleapis.com/iexcloud-hl37opg/api/logos/${selectedInstrument.symbol}.png`"
                    :alt="`${selectedInstrument.symbol}`"
                    class="block h-[40px] w-[40px] object-cover text-[8px]"
                  />
                </div>

                <div class="flex min-w-0 flex-col">
                  <span
                    x-text="selectedInstrument.symbol"
                    class="text-[14px] font-medium text-dark400"
                  ></span>
                  <span
                    x-text="selectedInstrument.name"
                    class="truncate text-[14px] text-gray700"
                  ></span>
                </div>
              </div>

              <button
                type="button"
                class="shrink-0 text-blue500 hover:text-blue600"
                @click="() => {
                    onDeleteSelectInstrument(selectedInstrument.instrumentId);
                    search = '';
                  }"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                  />
                </svg>
              </button>
            </div>
          </template>
        </div>
      </template>

      <div class="mt-14 flex justify-end space-x-4 md:space-x-6">
        <button
          type="button"
          @click="()  => {
            showModalAddStock = false;
            search = '';
            selectedInstruments = [];
          }"
          class="ms-4 inline-flex justify-center rounded-[8px] bg-blue300 py-[12px] px-[24px] text-[16px] font-semibold capitalize tracking-[0.11px] text-blue500 duration-200 ease-in-out hover:bg-blue400 md:w-[157px] md:px-[29px]"
        >
          Cancel
        </button>

        <button
          :disabled="!selectedInstruments.length || isLoading"
          type="button"
          :class="!selectedInstruments.length ? 'cursor-not-allowed' : 'cursor-pointer'"
          class="ms-4 inline-flex justify-center rounded-[8px] bg-blue500 py-[12px] px-[24px] text-[16px] font-semibold capitalize tracking-[0.11px] text-white duration-200 ease-in-out hover:bg-blue600 disabled:opacity-50 md:w-[157px] md:px-[29px]"
          @click="onSubmit()"
          x-html="submitButtonText"
        ></button>
      </div>
    </div>
  </div>
</div>